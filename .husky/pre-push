#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run Pulumi preview to catch infrastructure errors before push
echo "üîç Running Pulumi preview..."
cd infrastructure || exit 1

# Check if Pulumi is available
if ! command -v pulumi &> /dev/null; then
  echo "‚ö†Ô∏è  Pulumi not found, skipping preview"
  exit 0
fi

# Run preview (non-interactive)
if ! pulumi preview --non-interactive --suppress-outputs; then
  echo "‚ùå Pulumi preview failed! Fix errors before pushing."
  exit 1
fi

echo "‚úÖ Pulumi preview passed"
